#!/bin/sh

# Update wal with a new wallpaper every day

readonly WAL_DIR="$HOME/.cache/wal"
readonly LASTUPDATE_FILE="$WAL_DIR/lastupdate"
readonly WALL_DIR=$1
readonly TMP_FILE=$(mktemp /tmp/updatewal.XXXXXX)

CURRENT_DATE=$(date +"%Y%m%d")

[ ! -f $LASTUPDATE_FILE ] && echo 0 > $LASTUPDATE_FILE

PREVIOUSE_DATE=$(cat $LASTUPDATE_FILE)

NEXT_UPDATE=$(expr $PREVIOUSE_DATE + 1)

if [ $CURRENT_DATE -ge $NEXT_UPDATE ]; then
	find $WALL_DIR -type f > $TMP_FILE
	wal -i $(shuf -n 1 $TMP_FILE)
	rm $TMP_FILE
	echo $CURRENT_DATE > $LASTUPDATE_FILE
else
	wal -R
fi
